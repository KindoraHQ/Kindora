on: [push, pull_request]

jobs:
  debug-foundry:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository (full)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Show git info
        run: |
          echo "Current ref: $GITHUB_REF"
          git rev-parse --verify HEAD || true
          git status --porcelain --untracked-files=all || true

      - name: Print working directory and root files
        run: |
          echo "PWD: $(pwd)"
          echo "Root listing:"
          ls -la
          echo "src listing:"
          ls -la src || true
          echo "foundry.toml content:"
          sed -n '1,200p' foundry.toml || true
          echo "Show src/Kindora.sol head:"
          sed -n '1,200p' src/Kindora.sol || true

      - name: Forge version
        run: |
          which forge || true
          forge --version || true

      - name: Forge build (verbose)
        run: |
          forge build -v
